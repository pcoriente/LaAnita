<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
        <title>Menu de Ordenes de Compra</title>
        <h:outputStylesheet library="css" name="main.css"/>
        <h:outputScript library="js" name="lenguaje.js" />
    </h:head>
    <body>
        <div id="wrapper" align="center">
            <ui:include src="wrapper.xhtml" />
            <div id="content" align="center"  >
                <h:form id="form" >
                    <div align="right">

                        <p:commandButton 
                            icon="ui-icon-plus"
                            title="Crear orden de compra directa"
                            oncomplete="odecD.show();"   

                            />
                        <p:commandButton 
                            icon="ui-icon-note"
                            title="ir a Menú a Cotizaciones"
                            action="menuCotizaciones.xhtml"

                            />
                        <p:commandButton id="salir"
                                         icon="ui-icon-home"
                                         title="Salir de Listado de Requisiciones"
                                         action="index.xhtml"

                                         />
                    </div>

                    <!-- P A N E L   D E  A D M I N I S T R A C I O N... -->
                    <p:panel header="PANEL DE ADMINISTRACION DE ORDENES DE COMPRA" styleClass="quitaCuadro"  >
                        <h:outputText value="No hay ORDENES DE COMPRA que mostrar !!" rendered="#{empty mbOrdenCompra.listaOrdenesEncabezado}" />
                        <p:dataTable id="ordenCompra"
                                     value="#{mbOrdenCompra.listaOrdenesEncabezado}"
                                     var="oc"
                                     rowKey="#{oc}"
                                     selectionMode="single"
                                     selection="#{mbOrdenCompra.ordenElegida}"
                                     >
                            <p:ajax event="rowSelect" listener="#{mbOrdenCompra.dameOrdenCompra}"   
                                    oncomplete="odec.show()" 
                                    update=":form:dialogoOC "
                                    process="@this"
                                    > 
                            </p:ajax>
                            <p:column sortBy="#{oc.idOrdenCompra}" filterBy="#{oc.idOrdenCompra}" headerText="OC" filterMatchMode="contains" width="30"  >
                                <h:outputText value="#{oc.idOrdenCompra}"   />
                            </p:column>
                            <p:column sortBy="#{oc.idCotizacion}" filterBy="#{oc.idCotizacion}" headerText="COT" filterMatchMode="contains" width="30"  >
                                <h:outputText value="#{oc.idCotizacion}"   />
                            </p:column>
                            <p:column sortBy="#{oc.idRequisicion}" filterBy="#{oc.idRequisicion}" headerText="REQ" filterMatchMode="contains" width="30"  >
                                <h:outputText value="#{oc.idRequisicion}"   />
                            </p:column>
                            <p:column headerText="Empresa" >
                                <h:outputText value="#{oc.empresa.empresa}"   />
                            </p:column>
                            <p:column headerText="Proveedor">
                                <h:outputText value="#{oc.proveedor.contribuyente}"    />
                            </p:column>
                            <p:column headerText="F. Finaliz">
                                <h:outputText value="#{oc.fechaFinalizacion}"    />
                            </p:column>
                            <p:column headerText="F. Puesta">
                                <h:outputText value="#{oc.fechaPuesta}"    />
                            </p:column>
                            <p:column headerText="F. Entrega">
                                <h:outputText value="#{oc.fechaEntrega}"    />
                            </p:column>
                            <p:column headerText="Status">
                                <h:outputText value="#{oc.status}"    />
                            </p:column>

                        </p:dataTable>
                    </p:panel>

                    <!-- ORDENES QUE SIGUE EN EL PROCESO REQUISICION, COTIZACION Y ORDEN DE COMPRA -->
                    <p:dialog widgetVar="odec" width="950" header="MANTENIMIENTO DE ORDEN DE COMPRA" id="dialogoOC" modal="true">
                        <p:toolbar  id="tb" style="width: 900px; height: auto; margin:0 auto; " >  
                            <p:toolbarGroup id="toolbar" align="right">  
                                <p:commandButton
                                    icon="ui-icon-disk"
                                    title="Guardar orden de compra"
                                    actionListener="#{mbOrdenCompra.guardarOrden(mbOrdenCompra.ordenElegida.idOrdenCompra,mbOrdenCompra.ordenElegida.estado)}"
                                    oncomplete="odec.hide()"
                                    disabled="#{mbOrdenCompra.ordenElegida.estado eq 2 }"
                                    update=":form:ordenCompra"
                                    />
                                <p:commandButton
                                    icon="ui-icon-cancel"
                                    title="Cancelar orden de compra"
                                    actionListener="#{mbOrdenCompra.cancelarOrden(mbOrdenCompra.ordenElegida.idOrdenCompra,0)}"
                                    update=":form:ordenCompra"
                                    />
                                <p:separator />

                                <p:commandButton
                                    icon="ui-icon-mail-closed"
                                    title="Enviar orden de compra"
                                    disabled="#{mbOrdenCompra.ordenElegida.estado eq 1 }"
                                    actionListener="#{mbOrdenCompra.cargaContactos()}"
                                    oncomplete="correo.show();"
                                    update=":form:para :form:asunto :form:mensaje :form:tablaCorreos" />

                                <p:commandButton
                                    icon="ui-icon-print"
                                    title="Imprimir orden de compra"
                                    actionListener="#{mbOrdenCompra.generarReporte()}"
                                    ajax="false"
                                    disabled="#{mbOrdenCompra.ordenElegida.estado eq 1 }"
                                    />

                                <p:separator />

                                <p:commandButton id="salirOC"
                                                 icon="ui-icon-home"
                                                 title="Ir al menu principal"
                                                 action="index.xhtml"
                                                 ajax="false"
                                                 />
                            </p:toolbarGroup>  
                        </p:toolbar>
                        <p:separator style="width:900px;height:0.5px" />
                        <p:panelGrid id="OCEncabezado" style="width: 900px; height: auto; margin:0 auto; "  >
                            <p:row>
                                <p:column styleClass="fondoCelda"    >
                                    <h:outputLabel value="Orden de Compra: " styleClass="textoEtiquetas"/> 
                                </p:column>
                                <p:column  styleClass="fondoCelda"  >
                                    <h:outputLabel  value="#{mbOrdenCompra.ordenElegida.idOrdenCompra}" />
                                </p:column>
                                <p:column styleClass="fondoCelda" >
                                    <h:outputLabel value="Fechas: " styleClass="textoEtiquetas" /> 
                                </p:column>
                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel value="Emision: " styleClass="textoEtiquetas"/> 
                                </p:column>
                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel  value="#{mbOrdenCompra.ordenElegida.fechaCreacion}" />
                                </p:column>

                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel value="Entrega: " styleClass="textoEtiquetas"/> 
                                </p:column>
                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel  value="#{mbOrdenCompra.ordenElegida.fechaEntrega}" />
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel value="Empresa: " styleClass="textoEtiquetas"/> 
                                </p:column>
                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel  value="#{mbOrdenCompra.ordenElegida.empresa.empresa}" styleClass="textoContenido" /> 
                                </p:column>
                                <p:column styleClass="fondoCelda"   >
                                    <h:outputLabel value="Dirección entrega: " styleClass="textoEtiquetas" /> 
                                </p:column>
                                <p:column styleClass="fondoCelda"  colspan="4" >
                                    <h:outputLabel  value="#{mbOrdenCompra.ordenElegida.proveedor.direccionEntrega.toString()}" styleClass="textoContenido"  /> 
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column styleClass="fondoCelda"  rowspan="2" >
                                    <h:outputLabel value="Proveedor: " styleClass="textoEtiquetas" /> 
                                </p:column>
                                <p:column  styleClass="fondoCelda" rowspan="2" >
                                    <h:outputLabel  value="#{mbOrdenCompra.ordenElegida.proveedor.contribuyente.contribuyente}" styleClass="textoContenido"  />
                                </p:column>
                                <p:column styleClass="fondoCelda" >
                                    <h:outputLabel value="Dirección: " styleClass="textoEtiquetas"    /> 
                                </p:column>
                                <p:column styleClass="fondoCelda" colspan="4">
                                    <h:outputLabel  value="#{mbOrdenCompra.ordenElegida.proveedor.contribuyente.direccion.toString()}" styleClass="textoContenido" /> 
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column styleClass="fondoCelda" >
                                    <h:outputLabel value="Descuentos: " styleClass="textoEtiquetas" /> 
                                </p:column>
                                <p:column styleClass="fondoCelda"   >
                                    <h:outputLabel value="Comercial (%): " styleClass="textoEtiquetas" /> 
                                </p:column>
                                <p:column  styleClass="fondoCelda"  >
                                    <h:outputLabel  value="#{mbOrdenCompra.ordenElegida.desctoComercial}" styleClass="textoContenido"  />
                                </p:column>
                                <p:column styleClass="fondoCelda" >
                                    <h:outputLabel value="Pronto Pago (%): " styleClass="textoEtiquetas" /> 
                                </p:column>
                                <p:column  styleClass="fondoCelda" >
                                    <h:outputLabel  value="#{mbOrdenCompra.ordenElegida.desctoProntoPago}" styleClass="textoContenido"  />
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                        <p:separator style="width:900px;height:0.5px" />
                        <p:dataTable id="OCDetalle"
                                     value="#{mbOrdenCompra.listaOrdenDetalle}"
                                     var="det"

                                     >
                            <p:column headerText="Producto"  >
                                #{det.producto.toString()}
                            </p:column>
                            <p:column headerText="Cant. Ordenada" styleClass="alineacionD" >
                                #{det.cantOrdenada}
                            </p:column>
                            <p:column headerText="Nueva Cant." width="60" styleClass="alineacionD" >
                                <pe:inputNumber  value="#{det.cantidadSolicitada}"  id="ordenada"  
                                                 decimalPlaces="3"  minValue="0"
                                                 disabled="#{mbOrdenCompra.ordenElegida.estado eq 2 }"
                                                 >
                                    <p:ajax event="change" 
                                            listener="#{mbOrdenCompra.calculosOrdenCompra(det.producto.idProducto)}"
                                            process="@this"
                                            update="OCDetalle"
                                            />
                                </pe:inputNumber>
                            </p:column>
                            <p:column headerText="Costo Cotizado" styleClass="alineacionD">  
                                #{det.costoOrdenadoF}  
                            </p:column> 
                            <p:column headerText="1 Descuento (%)" styleClass="alineacionD">  
                                #{det.descuentoProducto}  
                            </p:column>
                            <p:column headerText="2 Descuento (%)" styleClass="alineacionD">  
                                #{det.descuentoProducto2}  
                            </p:column>

                            <p:column headerText="Subtotal" styleClass="alineacionD">  
                                <h:outputText value="#{det.subtotalF}" id="subtotal" >
                                    <f:convertNumber type="currency" locale="en-US"   />
                                </h:outputText>
                            </p:column>
                            <p:columnGroup type="footer" >  
                                <p:row >
                                    <p:column colspan="6"  style="text-align:right; font-size: 14px;" footerText="Importe:" />
                                    <p:column colspan="6"  id="general" footerText="#{mbOrdenCompra.subtotF}"  styleClass="alineacionD"  />
                                </p:row>
                                <p:row>
                                    <p:column colspan="2" style="text-align:right; background-color: whitesmoke; font-size: 14px; " footerText="Generales:"   />
                                    <p:column    id="sumaDescuentosTotales" footerText="#{mbOrdenCompra.sumaDescuentosGeneralesF}" styleClass="alineacionD" />

                                    <p:column style="text-align:right; font-size: 14px;" footerText="Por Productos:"/>
                                    <p:column  id="sumaDescuentosProductos" footerText="#{mbOrdenCompra.sumaDescuentosProductosF}" />

                                    <p:column style="text-align:right; font-size: 14px;" footerText="Desc. Totales:"/>
                                    <p:column  id="descuentoGeneralAplicado" footerText="#{mbOrdenCompra.sumaDescuentosTotalesF}" styleClass="alineacionD" />
                                </p:row>
                                <p:row>
                                    <p:column colspan="6" style="text-align:right; font-size: 14px;" footerText="Subtotal:"/>
                                    <p:column   id="subtotalBruto" footerText="#{mbOrdenCompra.subtotalBrutoF}" styleClass="alineacionD"/>
                                </p:row>
                                <p:row>
                                    <p:column colspan="6" style="text-align:right; font-size: 14px;" footerText="IVA:"/>
                                    <p:column  id="impuesto" footerText="#{mbOrdenCompra.impF}" styleClass="alineacionD"/>
                                </p:row>
                                <p:row>
                                    <p:column colspan="6" style="text-align:right; font-size: 14px;" footerText="Total :"/>
                                    <p:column   id="total" footerText="#{mbOrdenCompra.totalF}" styleClass="alineacionD">
                                    </p:column>
                                </p:row>
                            </p:columnGroup> 
                        </p:dataTable>
                    </p:dialog>


                    <!-- ///////////////////////////////////////////    D I  R E C T A S   ////////////////////////////////////////////////////              -->


                    <p:dialog widgetVar="odecD" width="1000" header="MANTENIMIENTO ORDENES DE COMPRA DIRECTAS" id="dialogoOCD" modal="true">
                        <p:messages id="mensajeProducto" showDetail="true" autoUpdate="true" closable="true" showSummary="false" />  
                        <p:panelGrid id="encabezadoOCD" style="width: 950px; height: auto; margin:0 auto; "  >
                            <p:row>
                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel value="Empresa: " styleClass="textoEtiquetas"/>
                                </p:column>
                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel   styleClass="textoContenido" />

                                    <p:selectOneMenu id="empresaD" value="#{mbOrdenCompra.mbEmpresas.empresa}" style="width: 250px;" >
                                        <f:converter converterId="converters.Empresa" />
                                        <f:selectItems value="#{mbOrdenCompra.mbEmpresas.listaObtenerEmpresas}" />
                                        <p:ajax event="change"
                                                update=":form:dirEmpD"
                                                />
                                    </p:selectOneMenu><br></br>
                                    <p:inplace id="verDireccionEmpresa" label="Ver direccion empresa"  editor="true" >  
                                        <h:outputLabel id="dirEmpD" value="#{mbOrdenCompra.mbEmpresas.empresa.direccion.toString()}"    />  
                                    </p:inplace> 
                                </p:column>

                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel  value="Emision: " styleClass="textoEtiquetas"/> 
                                </p:column>
                                <p:column styleClass="fondoCelda"    >
                                    <p:calendar id="fEmision"  
                                                value="#{mbOrdenCompra.ordenCompraEncabezado.fechaEmisionDirectas}" maxlength="8" size="10" style="width: 70px;">
                                    </p:calendar>
                                </p:column>
                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel  value="Entrega: " styleClass="textoEtiquetas"/> 
                                </p:column>
                                <p:column styleClass="fondoCelda"  >
                                    <p:column styleClass="fondoCelda"   >
                                        <p:calendar id="fEntrega"  
                                                    value="#{mbOrdenCompra.ordenCompraEncabezado.fechaEntregaDirectas}" maxlength="8" size="10" style="width: 70px;">
                                            <p:ajax event="dateSelect"
                                                    process="@this fEmision"
                                                    listener="#{mbOrdenCompra.validarRangoFechas()}"/>
                                        </p:calendar>
                                    </p:column>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column styleClass="fondoCelda"  rowspan="2"  >
                                    <h:outputLabel value="Proveedor: " styleClass="textoEtiquetas"  /> 
                                </p:column>
                                <p:column  styleClass="fondoCelda" rowspan="2"  >
                                    <h:outputLabel   styleClass="textoContenido"  />
                                    <p:selectOneMenu id="proveedorD"  value="#{mbOrdenCompra.mbProveedores.miniProveedor}" filter="true" filterMatchMode="contains" style="width: 250px;"  >
                                        <f:converter converterId="converters.miniProveedor" />
                                        <f:selectItems value="#{mbOrdenCompra.mbProveedores.listaMiniProveedores}"  />
                                        <p:ajax event="change"
                                                listener="#{mbOrdenCompra.cargaDatosProveedor()}"
                                                update=":form:dirProvD :form:dcD :form:ppD"
                                                />
                                    </p:selectOneMenu><br></br>
                                    <p:inplace id="verDireccionProveedor" label="Ver Direccion"  editor="true" >  
                                        <h:outputLabel id="dirProvD" value="#{mbOrdenCompra.provee.direccionEntrega}"    />  
                                    </p:inplace> 
                                </p:column>
                                <p:column styleClass="fondoCelda"   >
                                    <h:outputLabel value="Comercial (%): " styleClass="textoEtiquetas" /> 
                                </p:column>
                                <p:column  styleClass="fondoCelda">
                                    <h:outputLabel  id="dcD" value="#{mbOrdenCompra.provee.desctoComercial} " styleClass="textoContenido"  />
                                </p:column>
                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel  value="Pronto Pago (%): " styleClass="textoEtiquetas"  /> 
                                </p:column>
                                <p:column  styleClass="fondoCelda" >
                                    <h:outputLabel id="ppD"  value="#{mbOrdenCompra.provee.desctoProntoPago} " styleClass="textoContenido"  />
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel  value="Moneda: " styleClass="textoEtiquetas"  /> 
                                </p:column>
                                <p:column  styleClass="fondoCelda" colspan="3" >
                                    <p:selectOneMenu id="monedaD" value="#{mbOrdenCompra.mbMonedas.moneda}" style="width: 180px;"  >
                                        <f:converter converterId="converters.Moneda" />
                                        <f:selectItems value="#{mbOrdenCompra.mbMonedas.listaMonedas}" />
                                        <p:ajax event="change" />
                                    </p:selectOneMenu>
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                        <p:separator style="width:900px;height:0.5px" />
                        <p:toolbar  id="tbD" style="width: 900px; height: auto; margin:0 auto; " >  
                            <p:toolbarGroup id="toolbarD" align="right">  
                                <p:commandButton
                                    icon="ui-icon-search"
                                    title="Buscar Productos"
                                    process="@this"
                                    actionListener="#{mbOrdenCompra.limpiarCamposBusqueda()}"
                                    oncomplete="buscarProductoDlg.show()"
                                    update=":form:listaBuscarProductos :form:opcionParte"
                                    />
                                <p:commandButton
                                    icon="ui-icon-trash"
                                    title="Eliminar empaque de la orden de compra directa"
                                    actionListener="#{mbOrdenCompra.eliminarEmpaqueSeleccionado()}"
                                    update=":form:detalleOCD :form:listaBuscarProductos"
                                    />
                                <p:commandButton
                                    icon="ui-icon-clear"
                                    title="Limpiar formulario de orden de compra directa"

                                    update=":form:detalleOCD :form:encabezadoOCD "
                                    />
                                <p:separator />
                                <p:commandButton
                                    icon="ui-icon-disk"
                                    title="Guardar orden de compra directa"
                                    oncomplete="odecD.hide()"
                                    />
                                <p:commandButton
                                    icon="ui-icon-cancel"
                                    title="Cancelar orden de compra directa"
                                    />
                                <p:separator />

                                <p:commandButton
                                    icon="ui-icon-mail-closed"
                                    title="Enviar orden de compra directa"
                                    />

                                <p:commandButton
                                    icon="ui-icon-print"
                                    title="Imprimir orden de compra directa"
                                    />

                                <p:separator />

                                <p:commandButton id="salirOCD"
                                                 icon="ui-icon-home"
                                                 title="Ir al menu principal"
                                                 actionListener="#{mbOrdenCompra.terminar()}"
                                                 update=":form:empresaD :form:proveedorD"
                                                 />
                            </p:toolbarGroup>  
                        </p:toolbar>
                        <p:dataTable id="detalleOCD"
                                     value="#{mbOrdenCompra.listaEmpaque}"
                                     var="detD" rowKey="#{detD.idEmpaque}"
                                     selectionMode="single" 
                                     selection="#{mbOrdenCompra.empaque}">
                            <p:ajax event = "rowSelect"/>
                            <p:column headerText="No.">
                            </p:column>
                            <p:column headerText="Producto"  >
                                #{detD.toString()}
                            </p:column>
                            <p:column headerText="Cant." width="60" styleClass="alineacionD" >
                                <pe:inputNumber    id="cantD"  
                                                   style="width: 60px"
                                                   decimalPlaces="3"  minValue="0"
                                                   >
                                    <p:ajax event="change" 

                                            process="@this"
                                            update="detalleOCD"
                                            />
                                </pe:inputNumber>
                            </p:column>
                            <p:column headerText="Cost" styleClass="alineacionD">


                            </p:column> 
                            <p:column headerText="1 Descuento (%)" styleClass="alineacionD">  

                            </p:column>
                            <p:column headerText="2 Descuento (%)" styleClass="alineacionD">  

                            </p:column>

                            <p:column headerText="Subtotal" styleClass="alineacionD">  
                                <h:outputText  id="subtotalD" >
                                    <f:convertNumber type="currency" locale="en-US"   />
                                </h:outputText>


                            </p:column>


                            <p:columnGroup type="footer" >  
                                <p:row >
                                    <p:column colspan="6"  style="text-align:right; font-size: 14px;" footerText="Importe:" />
                                    <p:column colspan="6"  id="generalD"   styleClass="alineacionD"  />
                                </p:row>
                                <p:row>
                                    <p:column colspan="2" style="text-align:right; background-color: whitesmoke; font-size: 14px; " footerText="Generales:"   />
                                    <p:column    id="sumaDescuentosTotalesD"  styleClass="alineacionD" />

                                    <p:column style="text-align:right; font-size: 14px;" footerText="Por Productos:"/>
                                    <p:column  id="sumaDescuentosProductosD"  />

                                    <p:column style="text-align:right; font-size: 14px;" footerText="Desc. Totales:"/>
                                    <p:column  id="descuentoGeneralAplicadoD"  styleClass="alineacionD" />
                                </p:row>
                                <p:row>
                                    <p:column colspan="6" style="text-align:right; font-size: 14px;" footerText="Subtotal:"/>
                                    <p:column   id="subtotalBrutoD"  styleClass="alineacionD"/>
                                </p:row>
                                <p:row>
                                    <p:column colspan="6" style="text-align:right; font-size: 14px;" footerText="IVA:"/>
                                    <p:column  id="impuestoD"  styleClass="alineacionD"/>
                                </p:row>
                                <p:row>
                                    <p:column colspan="6" style="text-align:right; font-size: 14px;" footerText="Total :"/>
                                    <p:column   id="totalD"  styleClass="alineacionD">
                                    </p:column>
                                </p:row>
                            </p:columnGroup> 
                        </p:dataTable>
                    </p:dialog>

                    <!--  FORMULARIO DE ENVIO DE CORREO ///////////////////////////////////////////////////////////////////////////////////////////////////////  -->
                    <p:dialog widgetVar="correo" width="900" header="Formulario de envio de correo" id="dialogoCorreo" modal="true">
                        <p:messages id="messagePanel6" showDetail="true" closable="true" showSummary="false" autoUpdate="true" />
                        <p:panelGrid id="formCorreo" style="width:850px; height: auto; margin:0 auto; "  >
                            <p:row>
                                <p:column styleClass="fondoCelda" id="colPara"   >
                                    <h:outputLabel value="Para: " styleClass="textoEtiquetas"/> 
                                </p:column>
                                <p:column  styleClass="fondoCelda"  colspan="3" >
                                    <p:inputText id="para"  value="#{mbOrdenCompra.correo.para}"  size="80" />
                                </p:column>
                                <p:column  styleClass="fondoCelda"  >
                                    <p:dataTable id="tablaCorreos"
                                                 value="#{mbOrdenCompra.listaContactos}"
                                                 var="co"
                                                 rowKey="#{co.correo}"
                                                 selection="#{mbOrdenCompra.contactoElegido}"
                                                 selectionMode="single"
                                                 emptyMessage="No tiene correo el proveedor..."
                                                 >
                                        <p:ajax event="rowSelect" 
                                                listener="#{mbOrdenCompra.contactoSeleccion()}"
                                                update=":form:para"
                                                />
                                        <p:column  headerText="#{mbOrdenCompra.ordenElegida.proveedor.contribuyente.contribuyente}"   >
                                            <h:outputText value="#{co.correo}"   />
                                        </p:column>
                                    </p:dataTable>

                                </p:column> 
                            </p:row>
                            <p:row>
                                <p:column styleClass="fondoCelda"  >
                                    <h:outputLabel value="Asunto: " styleClass="textoEtiquetas" /> 
                                </p:column>
                                <p:column  styleClass="fondoCelda"  colspan="3" >
                                    <p:inputText id="asunto"  value="#{mbOrdenCompra.correo.asunto}"  size="80"  />
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column styleClass="fondoCelda" rowspan="6">
                                    <h:outputLabel value="Mensaje: " styleClass="textoEtiquetas" /> 
                                </p:column>
                                <p:column  styleClass="fondoCelda" colspan="3" >
                                    <p:inputTextarea  id="mensaje"  value="#{mbOrdenCompra.correo.mensaje}"  autoResize="false" rows="10" cols="80"  />
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                        <p:commandButton id="grabar" value="Enviar"  actionListener="#{mbOrdenCompra.enviarCorreo(mbOrdenCompra.correo.para)}" 
                                         update="para asunto mensaje"
                                         />
                        <p:commandButton value="Cancelar"
                                         actionListener="#{mbOrdenCompra.limpiarFormulario()}"
                                         update="para asunto mensaje"
                                         process="@this"/>
                        <p:blockUI  block="formCorreo" trigger="grabar">
                            <p:graphicImage value="/resources/images/big-roller.gif" />
                        </p:blockUI>
                    </p:dialog> 

                    <!-- B U S C A D O R  DE  P R O D U C T O S... -->
                    <p:dialog header="BUSCADOR DE PRODUCTOS" widgetVar="buscarProductoDlg" resizable="false" style="width: 600px;" modal="true" >
                        <p:messages id="msgBuscar" showDetail="true" autoUpdate="true" closable="true" />
                        <p:panelGrid id="buscarProductos" styleClass="sinBorde" >
                            <p:row >
                                <p:column >
                                    <h:outputLabel for="opciones" value="OPCIONES :" style="font-weight: bold; color: red;" />
                                </p:column>
                                <p:column >
                                    <p:selectOneRadio id="opciones" value="#{mbOrdenCompra.mbBuscar.tipoBuscar}" style="background-color: #ccc" >
                                        <f:selectItem itemLabel="SKU" itemValue="1" />
                                        <f:selectItem itemLabel="Genérico" itemValue="2" />
                                        <p:ajax listener="#{mbOrdenCompra.mbBuscar.verCambio()}" update="buscarProductos listaBuscarProductos" />
                                    </p:selectOneRadio>
                                </p:column>
                                <p:column rendered="#{mbOrdenCompra.mbBuscar.tipoBuscar=='1'}" >
                                    <p:inputText id="opcionSKU" value="#{mbOrdenCompra.mbBuscar.strBuscar}" maxlength="8" size="10" />
                                    <p:commandButton id="btnBuscarSKU" icon="ui-icon-check" title="Buscar" 
                                                     process="@this opcionSKU" actionListener="#{mbOrdenCompra.buscar()}" 
                                                     oncomplete="handleBuscar(xhr, status, args)" />
                                    <!--update=":main:mttoProductos"-->
                                </p:column>
                                <p:column rendered="#{mbOrdenCompra.mbBuscar.tipoBuscar=='2'}" >
                                    <p:autoComplete id="opcionParte" value="#{mbOrdenCompra.mbBuscar.parte}" maxlength="50" size="30"
                                                    completeMethod="#{mbOrdenCompra.mbBuscar.completePartes}" process="@this"
                                                    var="p" itemLabel="#{p.parte}" itemValue="#{p}" converter="converters.ParteBuscar" 
                                                    forceSelection="true" />
                                    <p:commandButton id="btnBuscarLista" icon="ui-icon-check" title="Buscar" 
                                                     process="@this opcionParte" actionListener="#{mbOrdenCompra.buscar()}" 
                                                     update="listaBuscarProductos" oncomplete="handleBuscar(xhr, status, args)" />
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                        <p:dataTable id="listaBuscarProductos" value="#{mbOrdenCompra.mbBuscar.productos}" 
                                     var="prod" scrollable="true" scrollHeight="200" style="width: 800px;"
                                     rowKey="#{prod.idEmpaque}" selectionMode="single" selection="#{mbOrdenCompra.mbBuscar.producto}" >
                            <p:ajax event = "rowSelect" update="seleccion" />

                            <f:facet name="header">
                                Seleccione un producto  
                            </f:facet>

                            <p:column headerText="SKU" style="width: 250px;" >
                                <h:outputText value="#{prod.cod_pro}" />
                            </p:column>

                            <p:column headerText="Producto" style="width: 250px;" >
                                <h:outputText value="#{prod.toString()}" />
                            </p:column>

                            <f:facet name="footer">
                                <p:commandButton id="seleccion" value="Seleccionar" 
                                                 disabled="#{mbOrdenCompra.mbBuscar.producto==null}"
                                                 actionListener="#{mbOrdenCompra.dameEmpaqueSeleccionado()}"  
                                                 oncomplete="buscarProductoDlg.hide()" 
                                                 update=":form:detalleOCD :form:listaBuscarProductos :form:mensajeProducto"/>
                            </f:facet>
                        </p:dataTable>
                    </p:dialog>

                    <script type="text/javascript">
                        function handleBuscar(xhr, status, args) {
                            if (!(args.validationFailed || !args.okBuscar)) {
                                buscarProductoDlg.hide();
                            }
                        }
                    </script>



                </h:form>
            </div>
            <!-- FIN DE CONTENIDO -->
            <ui:include src="footer.html" />
        </div>
    </body>
</html>
